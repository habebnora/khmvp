import{c as ge,r as n,j as e,B as l,u as ve,s as ce,t as y}from"./index-DmkZlZjy.js";import{A as Ne,a as we,C as z,b as m,I as S}from"./label-Zxuv03fs.js";import{A as se,C as ie,i as ae,_ as be,x as q,r as Ce,t as ke,v as O,w as Q,D as te,k as re,l as ne,m as le,h as de,T as Se,U as Be,W as Pe,j as Re,o as _e,M as Ae,B as oe,Z as xe,$ as Fe}from"./location-CSCqXxbz.js";import{C as ue,D as me,a as Ie,r as ze}from"./review-CmHXGQ_Z.js";import{R as De,a as U,C as Ee,Q as Te}from"./ClientApp-DdFqOFIo.js";import{u as pe}from"./useTranslation-DSe_g0-j.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Me=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],$e=ge("lock",Me);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Le=[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]],he=ge("smartphone",Le);function Ve({bookingData:c,onBack:Y,onPaymentSuccess:a}){const{t:G,language:H}=pe(),t=G.client.paymentPage,[o,j]=n.useState("card"),[g,u]=n.useState(!1),[f,D]=n.useState(!1),[w,W]=n.useState(""),[v,p]=n.useState(""),[B,J]=n.useState(""),[P,b]=n.useState(""),[E,X]=n.useState(""),[R,C]=n.useState(""),[k,T]=n.useState(""),_=c.amount*.1,N=c.amount+_,M=r=>{const $=r.replace(/\s+/g,"").replace(/[^0-9]/gi,"").match(/\d{4,16}/g),L=$&&$[0]||"",I=[];for(let i=0,ee=L.length;i<ee;i+=4)I.push(L.substring(i,i+4));return I.length?I.join(" "):r},Z=r=>{const x=r.replace(/\s+/g,"").replace(/[^0-9]/gi,"");return x.length>=2?`${x.slice(0,2)}/${x.slice(2,4)}`:x},A=async()=>{if(u(!0),await new Promise(r=>setTimeout(r,2e3)),o==="instapay"||o==="vodafone")D(!0),u(!1);else if(o==="fawry"){const r="FW"+Math.random().toString(36).substring(2,10).toUpperCase();p(r),u(!1)}else u(!1),a()},K=async()=>{u(!0),await new Promise(r=>setTimeout(r,1500)),u(!1),a()},F=async()=>{u(!0),await new Promise(r=>setTimeout(r,1e3)),D(!0),u(!1),alert(t.verificationCodeSent)};return e.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:[e.jsx("div",{className:"bg-white dark:bg-gray-800 shadow-sm sticky top-0 z-10",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(l,{onClick:Y,variant:"ghost",className:"p-2",children:H==="ar"?e.jsx(Ne,{className:"size-5"}):e.jsx(we,{className:"size-5"})}),e.jsx("div",{className:"flex-1",children:e.jsx("h1",{className:"text-xl",children:t.payment})})]})})}),e.jsxs("div",{className:"max-w-4xl mx-auto p-4 space-y-6",children:[e.jsxs(z,{className:"p-6",children:[e.jsx("h2",{className:"text-lg mb-4",children:t.bookingSummary}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:t.sitter}),e.jsx("span",{children:c.sitterName})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:t.service}),e.jsx("span",{children:c.service})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:t.date}),e.jsx("span",{children:c.date})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:t.duration}),e.jsxs("span",{children:[c.duration," ",t.hours]})]}),e.jsxs("div",{className:"border-t pt-3 mt-3",children:[e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:t.totalAmount}),e.jsxs("span",{children:[c.amount," ",t.egp]})]}),e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:t.platformFee}),e.jsxs("span",{children:[_.toFixed(2)," ",t.egp]})]}),e.jsxs("div",{className:"flex justify-between text-lg border-t pt-2 mt-2",children:[e.jsx("span",{children:t.finalAmount}),e.jsxs("span",{className:"text-[#FB5E7A]",children:[N.toFixed(2)," ",t.egp]})]})]})]})]}),e.jsxs("div",{className:"flex items-center justify-center gap-2 text-sm text-gray-600 dark:text-gray-400",children:[e.jsx($e,{className:"size-4"}),e.jsx("span",{children:t.securePayment})]}),e.jsxs(z,{className:"p-6",children:[e.jsx("h2",{className:"text-lg mb-4",children:t.selectPaymentMethod}),e.jsx(De,{value:o,onValueChange:r=>j(r),children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center space-x-2 rtl:space-x-reverse p-4 border rounded-lg cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800",children:[e.jsx(U,{value:"card",id:"payment-card"}),e.jsxs(m,{htmlFor:"payment-card",className:"flex-1 cursor-pointer flex items-center gap-3",children:[e.jsx(ue,{className:"size-5 text-blue-500"}),e.jsx("span",{children:t.creditCard})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 rtl:space-x-reverse p-4 border rounded-lg cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800",children:[e.jsx(U,{value:"instapay",id:"payment-instapay"}),e.jsxs(m,{htmlFor:"payment-instapay",className:"flex-1 cursor-pointer flex items-center gap-3",children:[e.jsx(he,{className:"size-5 text-purple-500"}),e.jsx("span",{children:t.instaPay})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 rtl:space-x-reverse p-4 border rounded-lg cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800",children:[e.jsx(U,{value:"vodafone",id:"payment-vodafone"}),e.jsxs(m,{htmlFor:"payment-vodafone",className:"flex-1 cursor-pointer flex items-center gap-3",children:[e.jsx(he,{className:"size-5 text-red-500"}),e.jsx("span",{children:t.vodafoneCash})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 rtl:space-x-reverse p-4 border rounded-lg cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800",children:[e.jsx(U,{value:"fawry",id:"payment-fawry"}),e.jsxs(m,{htmlFor:"payment-fawry",className:"flex-1 cursor-pointer flex items-center gap-3",children:[e.jsx(me,{className:"size-5 text-orange-500"}),e.jsx("span",{children:t.fawry})]})]})]})})]}),!v&&e.jsxs(z,{className:"p-6",children:[o==="card"&&!f&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(m,{children:t.cardNumber}),e.jsx(S,{type:"text",placeholder:"1234 5678 9012 3456",value:B,onChange:r=>J(M(r.target.value)),maxLength:19,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(m,{children:t.cardName}),e.jsx(S,{type:"text",placeholder:"John Doe",value:P,onChange:r=>b(r.target.value),className:"mt-2"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(m,{children:t.expiryDate}),e.jsx(S,{type:"text",placeholder:"MM/YY",value:E,onChange:r=>X(Z(r.target.value)),maxLength:5,className:"mt-2"})]}),e.jsxs("div",{children:[e.jsx(m,{children:t.cvv}),e.jsx(S,{type:"text",placeholder:"123",value:R,onChange:r=>C(r.target.value.replace(/\D/g,"")),maxLength:3,className:"mt-2"})]})]})]}),(o==="instapay"||o==="vodafone")&&!f&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs(se,{children:[e.jsx(ie,{className:"h-4 w-4"}),e.jsx(ae,{children:o==="instapay"?t.instaPayInstructions:t.vodafoneCashInstructions})]}),e.jsxs("div",{children:[e.jsx(m,{children:t.phoneNumber}),e.jsx(S,{type:"tel",placeholder:"01xxxxxxxxx",value:k,onChange:r=>T(r.target.value),className:"mt-2"})]}),e.jsx(l,{onClick:F,disabled:!k||g,variant:"outline",className:"w-full",children:t.verifyPhone})]}),f&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs(se,{className:"bg-green-50 dark:bg-green-900/20 border-green-500",children:[e.jsx(be,{className:"h-4 w-4 text-green-600"}),e.jsxs(ae,{className:"text-green-800 dark:text-green-200",children:[t.verificationCodeSentMsg," ",k]})]}),e.jsxs("div",{children:[e.jsx(m,{children:t.verificationCode}),e.jsx(S,{type:"text",placeholder:"123456",value:w,onChange:r=>W(r.target.value),maxLength:6,className:"mt-2"})]}),e.jsx(l,{onClick:K,disabled:!w||g,className:"w-full bg-[#FB5E7A] hover:bg-[#e5536e]",children:g?t.processingPayment:t.confirm}),e.jsx(l,{onClick:F,variant:"ghost",className:"w-full",children:t.resendCode})]}),o==="fawry"&&e.jsxs(se,{children:[e.jsx(ie,{className:"h-4 w-4"}),e.jsx(ae,{children:t.fawryInstructions})]})]}),v&&e.jsx(z,{className:"p-6 text-center",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-orange-500/10 flex items-center justify-center mx-auto",children:e.jsx(me,{className:"w-8 h-8 text-orange-500"})}),e.jsx("h3",{className:"text-lg",children:t.fawryCode}),e.jsx("div",{className:"text-3xl font-mono tracking-wider bg-gray-100 dark:bg-gray-800 p-4 rounded-lg",children:v}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:t.fawryInstructions})]})}),!f&&!v&&e.jsx(l,{onClick:A,disabled:g,className:"w-full bg-[#FB5E7A] hover:bg-[#e5536e]",size:"lg",children:g?t.processingPayment:`${t.payNow} - ${N.toFixed(2)} ${t.egp}`})]})]})}function He({}){const{user:c}=ve(),{t:Y}=pe(),a=Y.client.bookings,[G,H]=n.useState([]),[t,o]=n.useState(!0),[j,g]=n.useState(null),[u,f]=n.useState(!1),[D,w]=n.useState(!1),[W,v]=n.useState(!1),[p,B]=n.useState(null),[J,P]=n.useState(!1),[b,E]=n.useState(null),[X,R]=n.useState(!1),[C,k]=n.useState(0),[T,_]=n.useState(""),[N,M]=n.useState(!1),[Z,A]=n.useState(null),[K,F]=n.useState(0),r=n.useRef(null);n.useEffect(()=>{if(c?.id){x();const s=ce.channel("client-bookings").on("postgres_changes",{event:"UPDATE",schema:"public",table:"bookings",filter:`client_id=eq.${c.id}`},()=>{x()}).subscribe();return()=>{ce.removeChannel(s)}}},[c?.id]);const x=async()=>{try{if(o(!0),!c?.id)return;const s=await q.getClientBookings(c.id);if(s){const h=s.map(d=>({id:d.id,sitterId:d.sitter_id,sitterName:d.sitter?.full_name||"Sitter",sitterImage:d.sitter?.avatar_url||"https://images.unsplash.com/photo-1494790108377-be9c29b29330?w=400",date:d.date,time:d.start_time,duration:d.duration_hours,location:d.location,type:d.booking_type,status:d.status,price:d.total_price}));H(h)}}catch(s){console.error(s),y.error(a.error)}finally{o(!1)}},$=()=>{N?(M(!1),r.current&&clearInterval(r.current),A(new Blob(["mock audio"],{type:"audio/webm"}))):(M(!0),A(null),F(0),r.current=setInterval(()=>{F(s=>s+1)},1e3))},L=s=>{const h=Math.floor(s/60),d=s%60;return`${h}:${d.toString().padStart(2,"0")}`};n.useEffect(()=>()=>{r.current&&clearInterval(r.current)},[]);const I=s=>{const h={pending:"bg-yellow-100 text-yellow-700 dark:bg-yellow-900 dark:text-yellow-300",waiting_payment:"bg-orange-100 text-orange-700 dark:bg-orange-900 dark:text-orange-300",upcoming:"bg-blue-100 text-blue-700 dark:bg-blue-900 dark:text-blue-300",ongoing:"bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-300",completed:"bg-gray-100 text-gray-700 dark:bg-gray-700 dark:text-gray-300",cancelled:"bg-red-100 text-red-700 dark:bg-red-900 dark:text-red-300"};return e.jsx(oe,{className:h[s],children:s==="waiting_payment"?a.waitingPayment:a[s]||s})},i=s=>G.filter(h=>s==="history"?h.status==="completed"||h.status==="cancelled":s==="upcoming"?h.status==="upcoming"||h.status==="ongoing":h.status===s),ee=async()=>{if(!(!j||C===0||!c?.id))try{await ze.createReview({booking_id:j.id,reviewer_id:c.id,reviewee_id:j.sitterId,rating:C,comment:T}),y.success(a.thankYouReview),f(!1),k(0),_(""),A(null),x()}catch(s){console.error(s),y.error(a.error)}},je=async()=>{if(j)try{await q.updateStatus(j.id,"cancelled"),y.success(a.bookingCancelled),w(!1),g(null),x()}catch{y.error(a.error)}},ye=async()=>{if(p)try{await q.updateStatus(p.id,"upcoming"),y.success(a.paymentSuccess),v(!1),B(null),x()}catch{y.error(a.error)}},fe=async()=>{if(j)try{await q.updateStatus(j.id,"ongoing"),y.success(a.scanSuccess),R(!1),x()}catch{y.error(a.error)}};if(W&&p)return e.jsx(Ve,{bookingData:{sitterName:p.sitterName,service:p.type==="home"?a.homeCare:a.outsideCare,date:p.date,duration:p.duration,amount:p.price},onBack:()=>{v(!1),B(null)},onPaymentSuccess:ye});if(J&&b)return e.jsx(Ee,{onBack:()=>P(!1),bookingId:b.id,recipientId:b.sitterId,recipientName:b.sitterName,recipientImage:b.sitterImage});const V=s=>e.jsx(z,{className:"p-4",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsx("img",{src:s.sitterImage,alt:s.sitterName,className:"w-16 h-16 rounded-full object-cover"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"flex items-start justify-between mb-2",children:e.jsxs("div",{children:[e.jsxs("h3",{className:"mb-1",children:[a.khalaLabel,s.sitterName]}),I(s.status)]})}),e.jsxs("div",{className:"space-y-1 text-sm text-gray-600 dark:text-gray-400 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Re,{className:"w-4 h-4"}),e.jsx("span",{children:s.date})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_e,{className:"w-4 h-4"}),e.jsxs("span",{children:[s.time," (",s.duration," ",a.hours,")"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ae,{className:"w-4 h-4"}),e.jsx("span",{children:s.location})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(oe,{variant:"outline",children:s.type==="home"?a.atHome:a.outside}),e.jsxs("div",{className:"text-[#FB5E7A] mt-1 font-bold",children:[a.total,": ",s.price," ",a.egp]})]}),e.jsxs("div",{className:"flex gap-2",children:[s.status==="completed"&&!s.rating&&e.jsxs(l,{size:"sm",onClick:()=>{g(s),f(!0)},className:"bg-[#FB5E7A] hover:bg-[#e5536e]",children:[e.jsx(de,{className:"w-4 h-4 mr-1"}),a.rateService]}),s.status==="waiting_payment"&&e.jsxs(l,{size:"sm",className:"bg-green-600 hover:bg-green-700",onClick:()=>{B(s),v(!0)},children:[e.jsx(ue,{className:"w-4 h-4 mr-1"}),a.payNow]}),s.status==="upcoming"&&e.jsxs(e.Fragment,{children:[e.jsx(l,{size:"sm",variant:"outline",onClick:()=>{E(s),P(!0)},children:e.jsx(xe,{className:"w-4 h-4"})}),e.jsxs(l,{size:"sm",className:"bg-[#FB5E7A] hover:bg-[#e5536e]",onClick:()=>{g(s),R(!0)},children:[e.jsx(Te,{className:"w-4 h-4 mr-1"}),a.scanQR]})]}),s.status==="ongoing"&&e.jsxs(l,{size:"sm",variant:"outline",onClick:()=>{E(s),P(!0)},className:"w-full",children:[e.jsx(xe,{className:"w-4 h-4 mr-2"}),a.chat]}),s.status==="pending"&&e.jsxs(l,{size:"sm",variant:"outline",className:"text-red-600",onClick:()=>{g(s),w(!0)},children:[e.jsx(Fe,{className:"w-4 h-4 mr-1"}),a.cancel]})]})]})]})]})},s.id);return e.jsxs("div",{className:"max-w-4xl mx-auto px-4 pb-8",children:[t?e.jsx("div",{className:"text-center py-12 text-gray-500",children:a.loading}):e.jsxs(Ce,{defaultValue:"pending",className:"space-y-4",children:[e.jsxs("div",{className:"sticky top-0 z-50 bg-gray-50 dark:bg-gray-900 pt-4 pb-4 -mx-4 px-4 mb-2 border-b border-gray-100 dark:border-gray-800",children:[e.jsx("h1",{className:"text-[#FB5E7A] mb-4 text-2xl font-bold",children:a.title}),e.jsxs(ke,{className:"grid w-full grid-cols-4",children:[e.jsx(O,{value:"pending",children:a.pending}),e.jsx(O,{value:"waiting_payment",children:a.waitingPayment}),e.jsx(O,{value:"upcoming",children:a.upcoming}),e.jsx(O,{value:"history",children:a.completed})]})]}),e.jsx(Q,{value:"pending",className:"space-y-4 pt-2",children:i("pending").length===0?e.jsx("div",{className:"text-center py-12 text-gray-500",children:a.noRequests}):i("pending").map(V)}),e.jsx(Q,{value:"waiting_payment",className:"space-y-4",children:i("waiting_payment").length===0?e.jsx("div",{className:"text-center py-12 text-gray-500",children:a.noRequests}):i("waiting_payment").map(V)}),e.jsx(Q,{value:"upcoming",className:"space-y-4",children:i("upcoming").length===0?e.jsx("div",{className:"text-center py-12 text-gray-500",children:a.noRequests}):i("upcoming").map(V)}),e.jsx(Q,{value:"history",className:"space-y-4",children:i("history").length===0?e.jsx("div",{className:"text-center py-12 text-gray-500",children:a.noRequests}):i("history").map(V)})]}),e.jsx(te,{open:u,onOpenChange:f,children:e.jsxs(re,{children:[e.jsx(ne,{children:e.jsx(le,{children:a.rateService})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:a.rating}),e.jsx("div",{className:"flex gap-2 justify-center",children:[1,2,3,4,5].map(s=>e.jsx("button",{onClick:()=>k(s),className:"focus:outline-none",children:e.jsx(de,{className:`w-8 h-8 ${s<=C?"fill-yellow-400 text-yellow-400":"text-gray-300"}`})},s))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"review",children:a.writeReview}),e.jsx(Se,{id:"review",value:T,onChange:s=>_(s.target.value),rows:4,placeholder:a.reviewPlaceholder})]}),e.jsxs("div",{className:"flex flex-col items-center gap-3 border-t pt-4",children:[e.jsx(l,{variant:N?"destructive":"outline",size:"lg",onClick:$,className:`rounded-full w-16 h-16 flex items-center justify-center ${N?"animate-pulse":""}`,children:N?e.jsx(Ie,{className:"w-8 h-8"}):e.jsx(Be,{className:"w-8 h-8"})}),e.jsx("span",{className:"text-sm font-mono mt-2 text-gray-600 dark:text-gray-400",children:N?L(K):Z?a.voiceMessage:a.tapToRecord})]}),e.jsx(l,{onClick:ee,disabled:C===0,className:"w-full bg-[#FB5E7A] hover:bg-[#e5536e]",children:a.submit})]})]})}),e.jsx(te,{open:D,onOpenChange:w,children:e.jsxs(re,{children:[e.jsx(ne,{children:e.jsx(le,{children:a.cancelBooking})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:a.cancelConfirm}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(l,{variant:"outline",onClick:()=>w(!1),className:"flex-1",children:a.no}),e.jsx(l,{onClick:je,className:"flex-1 bg-red-500 hover:bg-red-600",children:a.yes})]})]})]})}),e.jsx(te,{open:X,onOpenChange:R,children:e.jsxs(re,{children:[e.jsx(ne,{children:e.jsx(le,{children:a.scanTitle})}),e.jsxs("div",{className:"flex flex-col items-center gap-4 py-6",children:[e.jsxs("div",{className:"w-64 h-64 bg-black rounded-lg flex items-center justify-center relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 border-2 border-[#FB5E7A] opacity-50 m-8"}),e.jsx("p",{className:"text-white text-sm text-center px-4",children:a.scanDesc})]}),e.jsxs(l,{className:"w-full bg-[#FB5E7A] hover:bg-[#e5536e]",onClick:fe,children:[e.jsx(Pe,{className:"w-4 h-4 mr-2"}),a.simulateScan]})]})]})})]})}export{He as default};
